# 門面模式——處方診斷系統

## A. 需求

醫院正在開發一個「處方診斷系統」，英文稱之為 Prescriber System。但由於醫院的技術人員不足，因此請你負責設計和開發處方診斷系統中的核心模組。
開發完畢之後，醫院中的所有技術人員會利用你的核心模組來客製化他們所需的處方診斷系統。你的核心模組必須支援以下需求。

1. 醫院的**病患資料庫 (Patient Database)** 中存放著大量的病患 (Patient) 資料，每一筆病患資料中都包含了以下資訊：
   - 身分證字號 (id) — 開頭為大寫英文字母，之後有 9 位數字。
   - 姓名 (name) — 長度 1~30 的英文字母。
   - 性別 (gender) — 男 (male) 或女 (female)
   - 年紀 (age) — 1~180 的整數
   - 身高 (height) — 1~500 的浮點數（單位：公分）
   - 體重 (weight) — 1~500 的浮點數 (單位：公斤）
   - 多項病例 (patient’s cases)：為病患在醫院中的所有看診案例紀錄 (case)。
   
2. **診斷流程：**
    1. 模組使用者向**診斷器 (Prescriber)** 輸入病患的身分證字號以及多項症狀 (Symptom) 來要求診斷。
       1. 由於可能會有多位用戶同時要求診斷 (Prescription Demand) ，而診斷器一次只會診斷一位病患，因此診斷器會將每一筆新的診斷要求排到隊列後方，並依照要求的先後順序依序診斷。直到隊列中沒有要求，就會停止診斷並且等待新的要求。
       
       2. 每一次診斷**耗時 3 秒。**
       
       3. 診斷完成之後，診斷器會通知用戶診斷結果，診斷結果為一道治療處方 (Prescription)。
          + 每一道處方包含以下資訊：
            + 名字 (name) — 4~30 個字元
            + 潛在疾病 (potential disease) — 3~100 個字元
            + 食用藥物 (medicines) — 包含多個藥物名稱，每個藥物名稱包含 3~30 個字元
            + 使用方法 (usage) — 長度 0~1000 的字元。
             
   2. 診斷完畢之後，用戶必須透過處方診斷系統將此診斷結果儲存成該病患的一筆病例，一項病例中包含多項症狀、處方，還有診斷時間 (case time)。
   
3. **處方診斷規則**：目前僅能診斷出三種潛在疾病，每一種疾病只對應一種處方：
   + 如果病患有打噴嚏、頭痛 (Headache) 和咳嗽 (Cough)等症狀的話，此時開出的治療處方是：
      + **處方名字**：清冠一號
      + **潛在疾病**：新冠肺炎（專業學名：**COVID-19**）
      + **食用藥物**：清冠一號
      + **使用方法**：將相關藥材裝入茶包裡，使用500 mL 溫、熱水沖泡悶煮 1~3 分鐘後即可飲用。
      
   + 如果病患是正直 18 歲的女性，而且還打 **噴嚏** (sneeze) 的話，此時開出的治療處方是：
      + **處方名字**：青春抑制劑
      + **潛在疾病**：有人想你了 (專業學名：**Attractive**)
      + **食用藥物**：假鬢角、臭味
      + **使用方法**：把假鬢角黏在臉的兩側，讓自己異性緣差一點，自然就不會有人想妳了。
      
   + 如果病患的 BMI 大於 26，而且還打呼 (snore) 的話，此時開出的治療處方是：
     + **處方名字**：打呼抑制劑
     + **潛在疾病**：睡眠呼吸中止症（專業學名：**SleepApneaSyndrome**）
     + **食用藥物**：一捲膠帶
     + **使用方法**：睡覺時，撕下兩塊膠帶，將兩塊膠帶交錯黏在關閉的嘴巴上，就不會打呼了。

## B. 設計需求 — 核心模組維護者導向

核心模組維護者對你設計的核心模組提出了一些需求：

1. 請你將病患資料庫和診斷器封裝成兩個類別 PatientDatabase 和 Prescriber。模組的維護者會使用 PatientDatabase 物件來查詢病患資料和添加病患的新病例，以及使用 Prescriber 物件來要求診斷某一位病患。

2. 維護者希望能夠在外部決定在收到診斷結果時要觸發什麼行為，而不用修改模組內部程式。

3. 維護者希望能夠在外部擴充新的處方診斷規則，而不用修改模組內部程式。

## C. 設計需求 — 模組使用者 (Client) 導向

模組使用者對你設計的核心模組提出了一些需求：

+ 使用者希望透過外部檔案設定核心模組的資料庫和支援的疾病種類，提升模組的彈性和客製化能力。
具體需求如下：

  1. 病患資料設定：
     + 使用 JSON 格式檔案定義病患資料庫中所有病患的資料。（對應需求 A-1）
     + 此 JSON 檔案將作為模組的資料來源，包含所有病患的資訊。
   
  2. 支援疾病設定：
     + 使用純文字檔案定義診斷器支援診斷的潛在疾病種類。（對應需求 A-3）
     + 檔案內容格式為每行一個疾病的專業學名，例如：

       ```
       COVID-19
       Attractive
       SleepApneaSyndrome
       ```

+ 簡化診斷流程開發人員調用核心模組的難度： 希望能讓使用者僅需撰寫 1 到 3 行程式碼，即可執行完整的診斷流程。在此過程中，使用者可以自由設定以下選項：

  + 設定病患資料： 設定包含病患資料的 JSON 檔案名稱（需求 C-1）。
  + 設定潛在疾病清單： 設定包含支援潛在疾病診斷的純文字檔案名稱（需求 C-2）。
  + 輸入病患資訊： 輸入欲診斷病患的姓名和多項症狀。
  + 設定診斷結果儲存方式： 指定診斷結果的儲存檔案名稱，並選擇以 JSON 或 CSV 格式儲存。
