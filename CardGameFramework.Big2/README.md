# 魔王題：大老二撲克牌遊戲！ ★★

## 魔王對冒險者們的喊話

各位冒險者們好！我們已經學會了三個設計模式了：策略模式 (Strategy Pattern)、樣板方法 (Template Method) 以及責任鍊模式 (Chain of responsibility Pattern)。

各位在這三個設計模式的挑戰題中，因為已經明確知道該任務的設計模式為何，因而可以很容易地知道要套什麼模式比較好。但是魔王題就不一樣了，你現在會收到一份莫名其妙的需求，然後你必須自己察覺需求中形成的 Forces，理性地在適合的地方套用設計模式。

你說 $\dots$ 「大老二撲克牌遊戲」不是實戰演練，是很幼稚的專案嗎？不，相信我，大多數企業專案面對的領域模型的邏輯複雜度都沒有比大老二來得困難，大老二撲克牌遊戲中無論是遊戲流程、牌型判斷還是人工智慧，都是一般企業商業邏輯難度的數倍以上。意即，如果你能寫得好大老二，企業中的商業邏輯對你來說幾乎是易如反掌。

並且，大老二撲克牌遊戲在行為面上的複雜度，形成了一共有 4~5 道的行為變動性 Forces，在類別圖上仔細查覺 Forces，然後再下去撰寫程式碼，你便會體會到舒適圈正在逐漸擴大。

另外，魔王題是附有嚴謹的輸入/輸出測資的，這是真槍實彈的演練，你必須在「嚴格的需求驗收」的程式碼限制之下，才能夠感受到更具體的 Forces。

通關魔王題的當下，正是你變強的過程！相信學院、相信我、相信自己！你應該要花多一點時間在這裡，回歸學生時期的自己，專心練等，讓自己變得更強吧！

## 需求大綱

你要開發一款「大老二」撲克牌遊戲 (Big-2)。正是因為遊戲中最大的數字是 2，所以這款遊戲被稱為大老二。在開發大老二的時候，你需要仔細地實現每一個遊戲規則，並且確定你設計的遊戲模組具備擴充性，可以在未來輕鬆地支援新的需求。

## 詞彙表 (Glossary)

大老二公司的老闆十分熟悉領域驅動設計 (Domain-Driven Design) 的觀念，他知道建立開發團隊一致認同的語言 (Ubiquitous Language) 才能大幅地提升合作的效率。
因此，這份需求中也體貼地替你準備了相關詞彙表 (Glossary)，也許你可以先速讀一下每個專有名詞在大老二撲克領域中的對應概念，再往下閱讀詳細的遊戲規則。
閱讀規則時如有疑惑可以再回到詞彙表中查詢相關概念。

1. **Big-2**：大老二撲克牌遊戲，正是我們想要你開發的遊戲。
2. **玩家 (Player)**：遊戲的參與者，可能為 AI 或是人類玩家 (Human Player)。
3. **撲克牌 (Card)：** 為 **(數字、花色)** 的組合。
4. **數字 (Rank)：** 撲克牌上的數字，為 $\{3,4,5,6,7,8,9,10,J,Q,K,A,2\}$ 中其中一項。
5. **花色 (Suit)：** 撲克牌上的花色，為 $\{梅花(♣),菱形(♦),愛心(♥),黑桃(♠)\}$。
   ,菱形(♦),愛心(♥),黑桃(♠)} 中其中一項。
6. **牌堆 (Deck)：** 一副 52 張不同撲克牌的牌堆。
7. **發牌 (Deal)：** 玩家從牌堆中的頂部取走一張牌。
8. **手牌 (Hand cards)：** 玩家擁有的手牌，最少 0 張，最多 13 張。
9. **牌型 (Card Pattern)：** 撲克牌的組合。
10. **打牌 (Play)：** 玩家從手牌中打出合法牌型至檯面上的動作。
11. **回合 (Round)：** 遊戲會有多個回合，在每回合之中，四位玩家輪流打牌，直到有三位玩家連續喊出了 PASS。
12. **頂牌 Top play：** 檯面上目前最大的牌型。
13. **頂牌玩家 Top player：** 打出頂牌的玩家。

## 遊戲流程 (Game Flow)

遊戲依序遵照以下流程進行：

1. 遊戲中有四位玩家。遊戲開始之後就會輸入每個玩家的名稱 (Name)。在這份需求中，我們會使用數字 $\{0,1,2,3\}$ 來索引這四位玩家。並且，假設目前輪到了玩家 $i$，則「下一輪的玩家」為索引值 $(i+1) \% 4$ 的玩家。
2. 將牌堆洗牌，並且將 52 張牌輪流發給四位玩家直到牌堆空 (Empty) 了為止。
3. 接著開始遊戲的第一回合：
    1. 在第一回合中，由擁有**梅花3**的玩家首先出牌。此玩家必須打出一副**合法且包含梅花3的牌型**。打出來的牌型便成為目前的頂牌。
    2. 然後，下一輪的玩家可以決定要執行以下其一動作：
        1. 喊 **PASS** —— 放棄出牌機會，不打任何牌。
        2. 打出一副比頂牌還大的合法牌型。此新打出來的牌型便成為新的頂牌。
    3. 下一輪的玩家重複步驟 b，直到玩家們連續喊出了三個PASS。
4. 第一回合結束後，開始下一回合。之後的每一回合都和第一回合有著相同的步驟和規則，不過多了以下規則：
    1. 每一回合結束之後，檯面上的牌會被清空，意即，清空頂牌。
    2. 上一回合的頂牌玩家將會成為新的回合的頂牌玩家，並且新的回合由頂牌玩家開始打牌，並且不能喊 PASS。舉例來說，如果上一回合結束時的頂牌玩家為 $玩家_{i}$，則在新的一回合時時，由 $玩家_{i}$ 開始打牌。
5. 不斷地進入下一回合、下一輪，直到有任一玩家將所有的手牌打完為止，此時遊戲將立刻結束，並且宣告此玩家為遊戲的贏家 (Winner)。

## 牌型以及牌型的大小 (Card Patterns and Ordering)

初版的需求中一共有以下四種牌型。只有相同種類的牌型之間可以比較大小。

- **單張 (Single)**：一張牌。
  - 大小比較規則：先比數字再比花色。
  - 數字由小到大依序為：$3 < 4 < 5 < 6 < 7 < 8 < 9 < 10 < J < Q < K < A < 2$
  - 花色由小到大依序為：梅花 < 菱形 < 愛心 < 黑桃
- **對子 (Pair)**：兩張數字相同的牌；例如：J-J, 3-3。
  - 大小比較規則：將兩張牌中較大的牌作為比較基準；例如：A-A > 7-7
- **順子 (Straight)：** 任何連續數字的五張牌；例如：3-4-5-6-7, 10-J-Q-K-A, J-Q-K-A-2，或是 K-A-2-3-4。
  - 大小比較規則：將五張牌中最大的牌作為比較基準；例如：2-3-4-5-6 > 10-J-Q-K-A
- **葫蘆 (Full house)：** 五張牌，其中以兩部分構成——三張數字相同的牌，和兩張數字相同的牌；例如： 3-3-3-2-2, A-A-A-7-7。
  - 大小比較規則：以三張數字相同的牌中，數字最大的牌作為比較基準；例如：A-A-A-3-3 > 5-5-5-2-2。

## 軟體設計需求：開閉原則 (Open-Closed Principle, OCP)

你的這份大老二程式設計，必須在「不同牌型的支援」上遵守 OCP：

**「在擴充新的牌型（或是刪除既有牌型）時，無須修改既有大老二設計中的所有類別程式，便能擴充。」**

其實實務上，很少需求會這麼清楚地告訴你「有哪些地方」要「遵守 OCP」。因為 OCP 非常技術性的用語，而不在需求方的認知之中。
所以多數時候要不要遵守 OCP，其實是「工程師自己說得算的」。可工程師通常只喜歡在自己的「舒適圈內」遵守 OCP，一旦面臨較複雜的擴充需求時，心態就容易浮躁，此時大多數新手夥伴會先將複雜的擴充性需求坐視不管，這就容易導致程式碼疊床架屋，越演越烈。

所以在這門課中，我將扮演著你的大魔王、你的教練。我會直接在需求中要求得清清楚楚、講得明明白白，告訴你哪一個部分必須遵守 OCP、一定得遵守 OCP。**於是你必須想清楚如何實現這等擴充性，你會冷靜且有條有理地去梳理 Forces、定義 Context、然後精準地套用正確的模式**。畢竟在大魔王的法眼下，有沒有完成需求、做到 OCP 都是顯而易見的！加油！。

> 小提示 （如果你真的想不透，要怎麼在不同牌型支援上遵守 OCP 的話，可以參考）：你目前只剛學完三個設計模式，這三個的其中一個（擴充性最強的那個）就是這個要求下的適用情境！

## 輸入格式

```
<洗好的牌堆>
<玩家 0 的名字>
<玩家 1 的名字>
<玩家 2 的名字>
<玩家 3 的名字>
<欲執行的動作 1>
<欲執行的動作 2>
<欲執行的動作 3>
...
```

1. 第一行指定了牌堆中依序存放的 52 張牌：

   ```
   <洗好的牌堆> := <花色>[<數字>] <花色>[<數字>] ... <花色>[<數字>]
   ```

    - `<花色>` 的值為 $C,D,H,S$ 其中一項，依序代表梅花、菱形、愛心和黑桃。而 `<數字>` 的值為 $3,4, \dots,9,10,J,Q,K,A,2$ 中其中一項。
    - 最左邊的牌(`<花色>[<數字>]`) 表示牌堆最底部的牌，而最右邊的牌為牌堆最上方的牌。在發牌時，會先從最上方的牌開始發牌。

2. 接下來的四行包含了玩家們的名字，名字為字母或數字的組成 （A-Z+a-z+0-9+中文字，有區分大小寫）。
3. 再來每一行 `<玩家欲執行的動作 i>` 為以下兩者結果中其一：
    1. `-1`：表達此玩家喊 PASS 了。
    2. 一連串以空白隔開的非負整數，表達玩家欲從手牌中出牌的索引值。（舉例來說：如果玩家有三張手牌：♠A, ♦J 和 ♥A，則他可以透過索引值 $0$ $2$ 來打出 ♠A ♥A 對子。
4. 在第一回合的開頭，由擁有`C[3]`（梅花3）的玩家給出`<欲執行的動作 1>` 。每位玩家輪流給出`<欲執行的動作 i>`，這些動作可能被判定為合法或是不合法，直到該玩家給出合法的動作為止才會輪到下一輪的玩家，然後下一輪的玩家再接著給出下一個 `<欲執行的動作>` 。

## 輸出格式

- 在每一回合的開頭，輸出：

  `新的回合開始了。`

- 輪到每一位玩家時：

    1. 首先輸出：`輪到<玩家的名字>了`

    2. 然後再使用漂亮的格式輸出玩家的手牌，如下：

       ```
       0    1    2    3    4    5    6     7 ...
       S[3] H[4] S[4] H[6] H[7] C[8] C[10] S[k] ...
       ```

       在第二行中，手牌由小到大依序由左至右排序，並且每一張牌之間都隔了一個空白，然後在第一行中，每一個手牌索引都置左對齊了每一張手牌的花色。

- 然後，如果玩家打出了一副合法的牌型，輸出單行：

  `玩家 <玩家的名字> 打出了 <牌型名稱> <花色>[<數字>] <花色>[<數字>] <花色>[<數字>] ...`

  - `<牌型名稱>` 為該牌型的中文名稱，可能為單張、對子、順子或是葫蘆。
  - `<牌型名稱>` 隨後接著的是牌型中包含的牌，以小到大依序由左至右排序。
- 如果玩家打出的是一副不合法的牌型，輸出單行：

  `此牌型不合法，請再嘗試一次。`

- 如果玩家在合法的情況執行了 PASS，輸出單行：

  `玩家 <玩家的名字> PASS`

- 如果玩家在不合法的情況執行了 PASS，輸出單行：

  `你不能在新的回合中喊 PASS`

  玩家不能在新的回合中的第一輪 PASS，此為唯一 PASS 不合法的情況。

- 當遊戲結束時，輸出單行：

  `遊戲結束，遊戲的勝利者為 <玩家的名字>`

## 範例輸入

```
S[8] S[9] S[3] D[J] S[7] H[3] C[2] C[9] H[2] D[7] S[K] C[6] C[3] D[4] H[7] C[A] D[A] D[K] H[4] D[8] C[4] H[10] H[A] S[10] H[Q] H[5] S[4] D[5] H[9] H[8] C[10] S[6] S[A] D[3] S[5] D[9] D[Q] H[K] C[Q] H[J] D[10] S[2] H[6] C[K] S[J] C[7] S[Q] D[6] D[2] C[J] C[8] C[5]
水球
火球
保齡球
地瓜球
0
0
3
4
4
10
10
11
-1
-1
-1
0 1
5 6
-1
7 8
7 8
5 6
-1
-1
-1
5 6
-1
-1
-1
0
0
3
2
0
3
5
4
2
8
-1
-1
-1
0
3
-1
0
-1
-1
-1
0
```

## 範例輸出

```
新的回合開始了。
輪到地瓜球了
0    1    2    3    4    5     6    7    8    9    10   11   12
C[3] C[4] S[7] S[8] H[9] D[10] S[J] D[Q] H[Q] D[A] S[A] D[2] H[2]
玩家 地瓜球 打出了 單張 C[3]
輪到水球了
0    1    2    3    4    5    6    7    8     9    10   11   12
C[5] D[5] C[6] D[6] S[6] D[8] C[9] D[9] S[10] D[J] H[J] C[K] C[A]
玩家 水球 打出了 單張 C[5]
輪到火球了
0    1    2    3    4    5    6    7     8    9    10   11   12
S[3] H[4] S[4] S[5] H[6] H[7] C[8] C[10] C[Q] S[Q] S[K] H[A] C[2]
玩家 火球 打出了 單張 S[5]
輪到保齡球了
0    1    2    3    4    5    6    7    8     9    10   11   12
D[3] H[3] D[4] H[5] C[7] D[7] H[8] S[9] H[10] C[J] D[K] H[K] S[2]
玩家 保齡球 打出了 單張 C[7]
輪到地瓜球了
0    1    2    3    4     5    6    7    8    9    10   11
C[4] S[7] S[8] H[9] D[10] S[J] D[Q] H[Q] D[A] S[A] D[2] H[2]
玩家 地瓜球 打出了 單張 D[10]
輪到水球了
0    1    2    3    4    5    6    7     8    9    10   11
D[5] C[6] D[6] S[6] D[8] C[9] D[9] S[10] D[J] H[J] C[K] C[A]
玩家 水球 打出了 單張 C[K]
輪到火球了
0    1    2    3    4    5    6     7    8    9    10   11
S[3] H[4] S[4] H[6] H[7] C[8] C[10] C[Q] S[Q] S[K] H[A] C[2]
玩家 火球 打出了 單張 H[A]
輪到保齡球了
0    1    2    3    4    5    6    7     8    9    10   11
D[3] H[3] D[4] H[5] D[7] H[8] S[9] H[10] C[J] D[K] H[K] S[2]
玩家 保齡球 打出了 單張 S[2]
輪到地瓜球了
0    1    2    3    4    5    6    7    8    9    10
C[4] S[7] S[8] H[9] S[J] D[Q] H[Q] D[A] S[A] D[2] H[2]
玩家 地瓜球 PASS.
輪到水球了
0    1    2    3    4    5    6    7     8    9    10
D[5] C[6] D[6] S[6] D[8] C[9] D[9] S[10] D[J] H[J] C[A]
玩家 水球 PASS.
輪到火球了
0    1    2    3    4    5    6     7    8    9    10
S[3] H[4] S[4] H[6] H[7] C[8] C[10] C[Q] S[Q] S[K] C[2]
玩家 火球 PASS.
新的回合開始了。
輪到保齡球了
0    1    2    3    4    5    6    7     8    9    10
D[3] H[3] D[4] H[5] D[7] H[8] S[9] H[10] C[J] D[K] H[K]
玩家 保齡球 打出了 對子 D[3] H[3]
輪到地瓜球了
0    1    2    3    4    5    6    7    8    9    10
C[4] S[7] S[8] H[9] S[J] D[Q] H[Q] D[A] S[A] D[2] H[2]
玩家 地瓜球 打出了 對子 D[Q] H[Q]
輪到水球了
0    1    2    3    4    5    6    7     8    9    10
D[5] C[6] D[6] S[6] D[8] C[9] D[9] S[10] D[J] H[J] C[A]
玩家 水球 PASS.
輪到火球了
0    1    2    3    4    5    6     7    8    9    10
S[3] H[4] S[4] H[6] H[7] C[8] C[10] C[Q] S[Q] S[K] C[2]
玩家 火球 打出了 對子 C[Q] S[Q]
輪到保齡球了
0    1    2    3    4    5     6    7    8
D[4] H[5] D[7] H[8] S[9] H[10] C[J] D[K] H[K]
玩家 保齡球 打出了 對子 D[K] H[K]
輪到地瓜球了
0    1    2    3    4    5    6    7    8
C[4] S[7] S[8] H[9] S[J] D[A] S[A] D[2] H[2]
玩家 地瓜球 打出了 對子 D[A] S[A]
輪到水球了
0    1    2    3    4    5    6    7     8    9    10
D[5] C[6] D[6] S[6] D[8] C[9] D[9] S[10] D[J] H[J] C[A]
玩家 水球 PASS.
輪到火球了
0    1    2    3    4    5    6     7    8
S[3] H[4] S[4] H[6] H[7] C[8] C[10] S[K] C[2]
玩家 火球 PASS.
輪到保齡球了
0    1    2    3    4    5     6
D[4] H[5] D[7] H[8] S[9] H[10] C[J]
玩家 保齡球 PASS.
新的回合開始了。
輪到地瓜球了
0    1    2    3    4    5    6
C[4] S[7] S[8] H[9] S[J] D[2] H[2]
玩家 地瓜球 打出了 對子 D[2] H[2]
輪到水球了
0    1    2    3    4    5    6    7     8    9    10
D[5] C[6] D[6] S[6] D[8] C[9] D[9] S[10] D[J] H[J] C[A]
玩家 水球 PASS.
輪到火球了
0    1    2    3    4    5    6     7    8
S[3] H[4] S[4] H[6] H[7] C[8] C[10] S[K] C[2]
玩家 火球 PASS.
輪到保齡球了
0    1    2    3    4    5     6
D[4] H[5] D[7] H[8] S[9] H[10] C[J]
玩家 保齡球 PASS.
新的回合開始了。
輪到地瓜球了
0    1    2    3    4
C[4] S[7] S[8] H[9] S[J]
玩家 地瓜球 打出了 單張 C[4]
輪到水球了
0    1    2    3    4    5    6    7     8    9    10
D[5] C[6] D[6] S[6] D[8] C[9] D[9] S[10] D[J] H[J] C[A]
玩家 水球 打出了 單張 D[5]
輪到火球了
0    1    2    3    4    5    6     7    8
S[3] H[4] S[4] H[6] H[7] C[8] C[10] S[K] C[2]
玩家 火球 打出了 單張 H[6]
輪到保齡球了
0    1    2    3    4    5     6
D[4] H[5] D[7] H[8] S[9] H[10] C[J]
玩家 保齡球 打出了 單張 D[7]
輪到地瓜球了
0    1    2    3
S[7] S[8] H[9] S[J]
玩家 地瓜球 打出了 單張 S[7]
輪到水球了
0    1    2    3    4    5    6     7    8    9
C[6] D[6] S[6] D[8] C[9] D[9] S[10] D[J] H[J] C[A]
玩家 水球 打出了 單張 D[8]
輪到火球了
0    1    2    3    4    5     6    7
S[3] H[4] S[4] H[7] C[8] C[10] S[K] C[2]
玩家 火球 打出了 單張 C[10]
輪到保齡球了
0    1    2    3    4     5
D[4] H[5] H[8] S[9] H[10] C[J]
玩家 保齡球 打出了 單張 H[10]
輪到地瓜球了
0    1    2
S[8] H[9] S[J]
玩家 地瓜球 打出了 單張 S[J]
輪到水球了
0    1    2    3    4    5     6    7    8
C[6] D[6] S[6] C[9] D[9] S[10] D[J] H[J] C[A]
玩家 水球 打出了 單張 C[A]
輪到火球了
0    1    2    3    4    5    6
S[3] H[4] S[4] H[7] C[8] S[K] C[2]
玩家 火球 PASS.
輪到保齡球了
0    1    2    3    4
D[4] H[5] H[8] S[9] C[J]
玩家 保齡球 PASS.
輪到地瓜球了
0    1
S[8] H[9]
玩家 地瓜球 PASS.
新的回合開始了。
輪到水球了
0    1    2    3    4    5     6    7
C[6] D[6] S[6] C[9] D[9] S[10] D[J] H[J]
玩家 水球 打出了 單張 C[6]
輪到火球了
0    1    2    3    4    5    6
S[3] H[4] S[4] H[7] C[8] S[K] C[2]
玩家 火球 打出了 單張 H[7]
輪到保齡球了
0    1    2    3    4
D[4] H[5] H[8] S[9] C[J]
玩家 保齡球 PASS.
輪到地瓜球了
0    1
S[8] H[9]
玩家 地瓜球 打出了 單張 S[8]
輪到水球了
0    1    2    3    4     5    6
D[6] S[6] C[9] D[9] S[10] D[J] H[J]
玩家 水球 PASS.
輪到火球了
0    1    2    3    4    5
S[3] H[4] S[4] C[8] S[K] C[2]
玩家 火球 PASS.
輪到保齡球了
0    1    2    3    4
D[4] H[5] H[8] S[9] C[J]
玩家 保齡球 PASS.
新的回合開始了。
輪到地瓜球了
0
H[9]
玩家 地瓜球 打出了 單張 H[9]
遊戲結束，遊戲的勝利者為 地瓜球
```
